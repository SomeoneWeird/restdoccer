<%
	
	var replacer = function(match, pIndent, pKey, pVal, pEnd) {
      var key = '<span class=json-key>';
      var val = '<span class=json-value>';
      var str = '<span class=json-string>';
      var r = pIndent || '';
      if (pKey)
         r = r + key + pKey.replace(/[": ]/g, '') + '</span>: ';
      if (pVal)
         r = r + (pVal[0] == '"' ? str : val) + pVal + '</span>';
      return r + (pEnd || '');
    }
    var prettyPrint = function(obj) {
      var jsonLine = /^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg;
      return JSON.stringify(obj, null, 3)
         .replace(/&/g, '&amp;').replace(/\\"/g, '&quot;')
         .replace(/</g, '&lt;').replace(/>/g, '&gt;')
         .replace(jsonLine, replacer);
    }

%>

<html>

	<head>

		<title> <%= name %> </title>

	</head>

	<body>

		<div class="meny">

			<% if(Object.keys(groups).length > 0) { %>

				<h3>Groups</h3>

				<% 

					for(var group in groups) { 

				%>

					<h5><%= group %></h5>

					<%

						for(var i = 0; i < groups[group].length; i++) {

					%>

						<a onclick='scrollClick(<%=groups[group][i].index%>)'><%=groups[group][i].endpoint%></a> <br>

					<%

						}

					%>

				<%

					}

				%>

			<% } else { %>

				<h3>No groups defined.</h3>

			<% } %>

		</div>

		<div class="contents">

			<div id="header">

				<% if(url) { %>

					<span class="logo"><a href="<%= url %>"><img src="<%= logo %>"></img></a></span>

				<% } %>

				<h1><%= name %></h1>

			</div>

			<div class="accordion" id="endpoints">

				<% for(var i = 0; i < endpoints.length; i++) { %>

					<div class="accordion-group">
				
	                  	<div class="accordion-heading">
		                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-<%=i%>">
		                      	<% 

	                      			var method = endpoints[i].method; 

	                				var badge = 'label-default';

	                      			if(method == "GET") {

	                      				badge = 'label-success';

	                      			} else if(method == "POST") {

	                      				badge = 'label-info';

	                      			} else if(method == "DELETE") {

	                      				badge = 'label-danger';

	                      			}

		                      	%>

		                      	<span class="label <%= badge %>"><%= method %></span>

		                      	<%= endpoints[i].endpoint %>

		                      	<% if(endpoints[i].tags && endpoints[i].tags.length > 0) { %>
		                      		<span class="label label-default pull-right"><%= endpoints[i].tags[i] %></span>
		                      	<% } %>

		                      	<% if(endpoints[i].experimental) { %>
		                      		<span class="label label-warning pull-right">experimental</span>
		                      	<% } %>

		                      	<% if(endpoints[i].development) { %>
		                      		<span class="label label-important pull-right">development</span>
		                      	<% } %>

		                    </a>
	                  	</div>

	                  	<div id="collapse-<%=i%>" class="accordion-body collapse">
	                    	<div class="accordion-inner">

	                    		<div class="page-header">
								  <h1><%= endpoints[i].endpoint %> <br>
								  <small><%= endpoints[i].description || '' %></small></h1>
								</div>

								<% if(endpoints[i].deprecated) { %>

									<div class="alert">
									  <button type="button" class="close" data-dismiss="alert">&times;</button>
									  <strong>Warning!</strong> This endpoint has been deprecated.
									</div>

								<% } %>

								<% if(endpoints[i].experimental) { %>

									<div class="alert alert-info">
										This API is experimental.
									</div>

								<% } %>

								<% if(endpoints[i].development) { %>

									<div class="alert alert-warning">
										This API is under development.
									</div>

								<% } %>

		                    	<% if((endpoints[i].urlParameters && Object.keys(endpoints[i].urlParameters).length > 0) || (endpoints[i].postParameters && Object.keys(endpoints[i].postParameters).length > 0)) { %>


		                    		<div class="accordion" id="accordion-params">

			                    		<% 

			                    			var urlParameters = endpoints[i].urlParameters;

			                    			if(urlParameters && Object.keys(urlParameters).length > 0) { 

			                    		%>

											<div class="accordion-group">
										
							                  	<div class="accordion-heading">
								                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-params" href="#collapse-<%=i%>-urlparams">Required URL Parameters</a>
					                  			</div>

							                  	<div id="collapse-<%=i%>-urlparams" class="accordion-body collapse">
							                    	<div class="accordion-inner">

														<table class="table table-striped">
															<thead>
																<tr>
																<th>Key</th>
																<th>Type</th>
																<th>Required</th>
																<th>Description</th>
																</tr>
															</thead>
															<tbody>

																<% for(var key in urlParameters) { 

																		var keyData = urlParameters[key]

																%>

																	<tr>
																		<td><%=key%></td>
																		<td><%=keyData.type || "Unspecified" %></td>
																		<td><%=keyData.required || false %></td>
																		<td><%=keyData.description || "" %></td>
																	</tr>

																<% } %>

															</tbody>

														</table>

													</div>

												</div>

											</div>

		                    			<% } else { %>

		                    				<div class="accordion-group">
										
							                  	<div class="accordion-heading">
								                    <span class="accordion-toggle">
								                    	No required URL Parameters
								                    </span>
					                  			</div>

					                  		</div>

					                  	<% } %>

			                    		<% 

			                    			var postParameters = endpoints[i].postParameters;

			                    			if(postParameters && Object.keys(postParameters).length > 0) {

			                    		%>

		                    				<div class="accordion-group">
										
							                  	<div class="accordion-heading">
								                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-params" href="#collapse-<%=i%>-postparams">Required POST Parameters</a>
					                  			</div>

					                  			<div id="collapse-<%=i%>-postparams" class="accordion-body collapse ">

							                    	<div class="accordion-inner">

														<table class="table table-striped">
															<thead>
																<tr>
																<th>Key</th>
																<th>Type</th>
																<th>Required</th>
																<th>Description</th>
																</tr>
															</thead>
															<tbody>

																<% for(var key in postParameters) { 

																		var keyData = postParameters[key]

																%>

																	<tr>
																		<td><%=key%></td>
																		<td><%=keyData.type || "Unspecified" %></td>
																		<td><%=keyData.required || false %></td>
																		<td><%=keyData.description || "" %></td>
																	</tr>

																<% } %>

															</tbody>
														</table>

													</div>

												</div>

											</div>

	                    				<% } else { %>

	                    					<div class="accordion-group">
										
							                  	<div class="accordion-heading">
								                    <span class="accordion-toggle">
								                    	No required POST Parameters
								                    </span>
					                  			</div>

					                  		</div>

					                  	<% } %>

		                    		</div>

			                    <% } %>

		                    	<br>

		                    	<% if(endpoints[i].responses && endpoints[i].responses.success !== undefined) { %>

			                    	<div style="width: 50%; float: left;">

		                    			<h5><span class="label label-success">Successful Response</span></h5>

		                    			<% if(endpoints[i].responses.success_msg) { %>

		                    				<h6><%=endpoints[i].responses.success_msg %></h6>

		                    			<% } %>


		                    			<pre><%- prettyPrint(endpoints[i].responses.success) %></pre>

		                    		</div>

		                    	<% } %>

		                    	<% if(endpoints[i].responses && endpoints[i].responses.error !== undefined) { %>

		                    		<div style="width: 50%; float: right;">

		                    			<h5><span class="label label-important">Response on error</span></h5>	                    			
		                    			<% if(endpoints[i].responses.error_msg) { %>

		                    				<h6><%=endpoints[i].responses.error_msg %></h6>

		                    			<% } %>

		                    			<pre><%- prettyPrint(endpoints[i].responses.error) %></pre>

		                    		</div>

		                    	<% } %>

							</div>

	                  	</div>
	         
	        		</div>

	        	<% } %>

	        </div>

	        <% if(copyright) { %>
		        <div class="copyright"><%= copyright %> &copy;</div>
	        <% } %>

	    </div>

	    <script>

	    	var meny = Meny.create({
			    menuElement: document.querySelector( '.meny' ),
			    contentsElement: document.querySelector( '.contents' ),
			});

			var scrollClick = function(index) {

				meny.close();
				$('.contents').animate({ scrollTop: $('#collapse-' + index).offset().top }, 300);			

			}

		</script>

	</body>

</html>